<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMPLETE SELF HOSTED ARCHITECTURE</title>
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    
    <style>
    /* Light mode variables */
    :root {
      --primary: #007AFF;
      --primary-hover: #0051D5;
      --success: #34C759;
      --warning: #FF9500;
      --danger: #FF3B30;
      --text-primary: #000000;
      --text-secondary: #3C3C43;
      --text-tertiary: #8E8E93;
      --bg-primary: #FFFFFF;
      --bg-secondary: #F2F2F7;
      --bg-tertiary: #FFFFFF;
      --bg-elevated: #FFFFFF;
      --border: rgba(0, 0, 0, 0.1);
      --border-subtle: rgba(0, 0, 0, 0.04);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.12);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1), 0 4px 10px rgba(0, 0, 0, 0.08);
      --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.15);
      --backdrop: rgba(255, 255, 255, 0.8);
      --code-bg: #F7F7FA;
      --code-border: rgba(0, 0, 0, 0.06);
      --nav-bg: rgba(255, 255, 255, 0.72);
      --card-bg: #FFFFFF;
      --hover-bg: rgba(0, 122, 255, 0.08);
    }
    
    /* Dark mode variables */
    [data-theme="dark"] {
      --primary: #0A84FF;
      --primary-hover: #409CFF;
      --success: #32D74B;
      --warning: #FF9F0A;
      --danger: #FF453A;
      --text-primary: #FFFFFF;
      --text-secondary: #EBEBF5;
      --text-tertiary: #8E8E93;
      --bg-primary: #000000;
      --bg-secondary: #1C1C1E;
      --bg-tertiary: #2C2C2E;
      --bg-elevated: #1C1C1E;
      --border: rgba(255, 255, 255, 0.15);
      --border-subtle: rgba(255, 255, 255, 0.06);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.4);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4), 0 2px 4px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5), 0 4px 10px rgba(0, 0, 0, 0.4);
      --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.6);
      --backdrop: rgba(28, 28, 30, 0.8);
      --code-bg: #1C1C1E;
      --code-border: rgba(255, 255, 255, 0.08);
      --nav-bg: rgba(28, 28, 30, 0.72);
      --card-bg: #1C1C1E;
      --hover-bg: rgba(10, 132, 255, 0.15);
    }
    
    /* Auto theme based on system preference */
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) {
        --primary: #0A84FF;
        --primary-hover: #409CFF;
        --success: #32D74B;
        --warning: #FF9F0A;
        --danger: #FF453A;
        --text-primary: #FFFFFF;
        --text-secondary: #EBEBF5;
        --text-tertiary: #8E8E93;
        --bg-primary: #000000;
        --bg-secondary: #1C1C1E;
        --bg-tertiary: #2C2C2E;
        --bg-elevated: #1C1C1E;
        --border: rgba(255, 255, 255, 0.15);
        --border-subtle: rgba(255, 255, 255, 0.06);
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.4);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4), 0 2px 4px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5), 0 4px 10px rgba(0, 0, 0, 0.4);
        --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.6);
        --backdrop: rgba(28, 28, 30, 0.8);
        --code-bg: #1C1C1E;
        --code-border: rgba(255, 255, 255, 0.08);
        --nav-bg: rgba(28, 28, 30, 0.72);
        --card-bg: #1C1C1E;
        --hover-bg: rgba(10, 132, 255, 0.15);
      }
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
      font-size: 17px;
      line-height: 1.6;
      color: var(--text-primary);
      background: var(--bg-primary);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
    }
    
    /* Typography */
    p {
      margin: 1.2rem 0;
      color: var(--text-secondary);
      letter-spacing: -0.011em;
    }
    
    a {
      color: var(--primary);
      text-decoration: none;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 2px;
    }
    
    a:hover {
      color: var(--primary-hover);
      text-decoration: none;
    }
    
    a:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    
    /* Headings */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.2;
      margin-top: 2.5rem;
      margin-bottom: 1rem;
      letter-spacing: -0.02em;
      color: var(--text-primary);
    }
    
    h1 {
      font-size: 3rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-top: 0;
      margin-bottom: 1.5rem;
    }
    
    h2 {
      font-size: 2rem;
      font-weight: 600;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-subtle);
      padding-bottom: 0.75rem;
      margin-top: 3rem;
    }
    
    h3 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    h4 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    /* Lists */
    ul, ol {
      padding-left: 2rem;
      margin: 1.5rem 0;
      color: var(--text-secondary);
    }
    
    li {
      margin: 0.75rem 0;
      line-height: 1.6;
    }
    
    /* Strong text */
    strong, b {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* Navigation */
    .nav-wrapper {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--nav-bg);
      backdrop-filter: saturate(180%) blur(20px);
      -webkit-backdrop-filter: saturate(180%) blur(20px);
      border-bottom: 1px solid var(--border);
      margin-bottom: 2rem;
    }
    
    nav {
      padding: 1rem 0;
    }
    
    .nav-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    
    nav li {
      margin: 0;
    }
    
    nav a {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    nav a:hover {
      background: var(--hover-bg);
      color: var(--primary);
    }
    
    nav a:focus {
      outline: none;
    }
    
    /* Theme Switcher */
    .theme-switcher {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.375rem;
      background: var(--bg-secondary);
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
    }
    
    .theme-btn {
      padding: 0.375rem 0.625rem;
      background: transparent;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-tertiary);
      font-size: 0.875rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .theme-btn:hover {
      color: var(--text-secondary);
    }
    
    .theme-btn.active {
      background: var(--card-bg);
      color: var(--text-primary);
      box-shadow: var(--shadow-sm);
    }
    
    /* Code blocks */
    pre {
      background: var(--code-bg);
      padding: 1.5rem;
      border-radius: 12px;
      overflow-x: auto;
      border: 1px solid var(--code-border);
      margin: 2rem 0;
      font-size: 0.875rem;
      box-shadow: var(--shadow-sm);
    }
    
    code {
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
      background: var(--code-bg);
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-size: 0.875em;
      border: 1px solid var(--code-border);
    }
    
    pre code {
      background: none;
      padding: 0;
      border: none;
      font-size: 0.875rem;
    }
    
    /* Tables */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin: 2rem 0;
      font-size: 0.95rem;
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow-md);
    }
    
    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border-subtle);
    }
    
    th {
      background: var(--bg-secondary);
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    td {
      color: var(--text-secondary);
    }
    
    tr:last-child td {
      border-bottom: none;
    }
    
    tr:hover {
      background: var(--hover-bg);
    }
    
    /* Blockquotes */
    blockquote {
      margin: 2rem 0;
      padding: 1.25rem;
      border-left: 4px solid var(--primary);
      background: var(--bg-secondary);
      border-radius: 0 12px 12px 0;
      color: var(--text-secondary);
      font-style: normal;
    }
    
    blockquote p {
      margin: 0.5rem 0;
    }
    
    /* Horizontal rules */
    hr {
      border: none;
      height: 1px;
      background: var(--border);
      margin: 3rem 0;
    }
    
    /* Cards */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1rem 0;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }
    
    /* Main content */
    main {
      min-height: calc(100vh - 200px);
      padding: 2rem 0;
    }
    
    /* Footer */
    footer {
      margin-top: 4rem;
      padding: 2rem 0;
      border-top: 1px solid var(--border);
      color: var(--text-tertiary);
      font-size: 0.875rem;
      text-align: center;
    }
    
    /* Grid for cards */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      h1 { font-size: 2.5rem; }
      h2 { font-size: 1.75rem; }
      h3 { font-size: 1.375rem; }
      
      .nav-content {
        flex-direction: column;
        gap: 1rem;
      }
      
      nav ul {
        flex-wrap: wrap;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="nav-wrapper">
    <div class="container">
      <nav class="nav-content">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/architecture/">Architecture</a></li>
          <li><a href="/all-docs/">All Docs</a></li>
          <li><a href="/learning-roadmap/">Learning Roadmaps</a></li>
          <li><a href="/devmentor/">DevMentor</a></li>
          <li><a href="/quizmentor/">QuizMentor</a></li>
          <li><a href="/harvest/">Harvest.ai</a></li>
          <li><a href="/naturequest-auth/">Auth</a></li>
          <li><a href="/infrastructure/">Infrastructure</a></li>
        </ul>
        <div class="theme-switcher" aria-label="Theme Switcher">
          <button class="theme-btn" data-theme="light" aria-pressed="false" title="Light mode">ğŸŒ Light</button>
          <button class="theme-btn active" data-theme="auto" aria-pressed="true" title="Auto mode">ğŸ§­ Auto</button>
          <button class="theme-btn" data-theme="dark" aria-pressed="false" title="Dark mode">ğŸŒ™ Dark</button>
        </div>
      </nav>
    </div>
  </div>

  <main class="container">
    <div class="product-header" style="background: #f6f8fa; padding: 1rem; border-radius: 5px; margin-bottom: 2rem;">
  <span style="color: #666;">QuizMentor</span> / 
  <span style="color: #999;">COMPLETE_SELF_HOSTED_ARCHITECTURE.md</span>
</div>

<h1>COMPLETE SELF HOSTED ARCHITECTURE</h1>


<h1 id="quizmentor-complete-self-hosted-architecture">QuizMentor Complete Self-Hosted Architecture</h1>

<h2 id="-why-self-host-everything">ğŸ¯ Why Self-Host Everything?</h2>

<p>If weâ€™re using Kubernetes, letâ€™s maximize value:</p>
<ul>
  <li><strong>PostgreSQL</strong>: Save $25/month from Supabase</li>
  <li><strong>Auth (Keycloak/Ory)</strong>: Full control, SSO, enterprise features</li>
  <li><strong>Notifications</strong>: Push, SMS, Email all integrated</li>
  <li><strong>Offline</strong>: Local-first with sync</li>
  <li><strong>Analytics</strong>: Own your data with PostHog/Plausible</li>
  <li><strong>Mobile</strong>: React Native + Push notifications</li>
</ul>

<hr />

<h2 id="ï¸-complete-architecture">ğŸ—ï¸ Complete Architecture</h2>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="s">â”‚                    CloudFlare (CDN + DDoS)                â”‚</span>
<span class="s">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
                              <span class="s">â”‚</span>
<span class="s">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="s">â”‚                 Kubernetes Cluster (3-5 nodes)            â”‚</span>
<span class="s">â”‚                                                           â”‚</span>
<span class="s">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span>
<span class="s">â”‚  â”‚                  Ingress Layer                       â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Traefik/NGINX (Load balancing, SSL)             â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Rate limiting, WAF                              â”‚ â”‚</span>
<span class="s">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span>
<span class="s">â”‚                                                           â”‚</span>
<span class="s">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span>
<span class="s">â”‚  â”‚                Frontend Services                     â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Next.js Web App (SSR + PWA)                     â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - React Native API (Mobile backend)                â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Admin Dashboard                                  â”‚ â”‚</span>
<span class="s">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span>
<span class="s">â”‚                                                           â”‚</span>
<span class="s">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span>
<span class="s">â”‚  â”‚              Core Services (Your Engines)            â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - API Gateway (Kong/Tyk)                          â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Bloom Validator (NLP models in memory)          â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Adaptive Engine (ML algorithms)                 â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Learning Orchestrator                           â”‚ â”‚</span>
<span class="s">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span>
<span class="s">â”‚                                                           â”‚</span>
<span class="s">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span>
<span class="s">â”‚  â”‚                 Platform Services                    â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Keycloak (Auth, SSO, OAuth, 2FA)               â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Novu/Knock (Notifications orchestrator)         â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - PostHog (Analytics + Feature flags)             â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Temporal (Workflow orchestration)               â”‚ â”‚</span>
<span class="s">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span>
<span class="s">â”‚                                                           â”‚</span>
<span class="s">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span>
<span class="s">â”‚  â”‚                   Data Layer                         â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - PostgreSQL (Primary DB + TimescaleDB)           â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Redis (Cache + Pub/Sub + Queues)               â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Qdrant (Vector search)                          â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - MinIO (S3-compatible object storage)            â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - ClickHouse (Analytics DB)                       â”‚ â”‚</span>
<span class="s">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span>
<span class="s">â”‚                                                           â”‚</span>
<span class="s">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span>
<span class="s">â”‚  â”‚              Background Services                     â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Scrapers (CronJobs)                             â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Email workers (SMTP)                            â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Push notification service                       â”‚ â”‚</span>
<span class="s">â”‚  â”‚  - Sync service (Offline support)                  â”‚ â”‚</span>
<span class="s">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span>
<span class="s">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div></div>

<hr />

<h2 id="1ï¸âƒ£-self-hosted-auth-keycloak-vs-ory-vs-zitadel">1ï¸âƒ£ Self-Hosted Auth (Keycloak vs Ory vs Zitadel)</h2>

<h3 id="keycloak-enterprise-grade-feature-rich">Keycloak (Enterprise-grade, Feature-rich)</h3>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># keycloak-deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">keycloak</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">keycloak</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">quay.io/keycloak/keycloak:22.0</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KC_DB</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">postgres</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KC_DB_URL_HOST</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">postgresql</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KC_DB_URL_DATABASE</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">keycloak</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KC_DB_USERNAME</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">keycloak</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KC_HOSTNAME</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">auth.quizmentor.app</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">KC_PROXY</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">edge</span>
        <span class="na">command</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">/opt/keycloak/bin/kc.sh</span>
        <span class="pi">-</span> <span class="s">start</span>
        <span class="pi">-</span> <span class="s">--optimized</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">512Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">250m"</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
</code></pre></div></div>

<h3 id="features-you-get">Features You Get:</h3>
<ul>
  <li>GitHub/Google/Social OAuth</li>
  <li>SAML, LDAP (enterprise)</li>
  <li>2FA/MFA with TOTP</li>
  <li>User federation</li>
  <li>Fine-grained permissions</li>
  <li>Password policies</li>
  <li>Session management</li>
  <li>Admin UI included</li>
</ul>

<hr />

<h2 id="2ï¸âƒ£-self-hosted-postgresql-with-ha">2ï¸âƒ£ Self-Hosted PostgreSQL with HA</h2>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># postgres-ha.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">postgresql.cnpg.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Cluster</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">postgres-cluster</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">instances</span><span class="pi">:</span> <span class="m">3</span>  <span class="c1"># 1 primary, 2 replicas</span>
  
  <span class="na">postgresql</span><span class="pi">:</span>
    <span class="na">parameters</span><span class="pi">:</span>
      <span class="na">max_connections</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200"</span>
      <span class="na">shared_buffers</span><span class="pi">:</span> <span class="s2">"</span><span class="s">256MB"</span>
      <span class="na">effective_cache_size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1GB"</span>
      <span class="c1"># Performance tuning</span>
      <span class="na">random_page_cost</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.1"</span>
      <span class="na">effective_io_concurrency</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200"</span>
      
  <span class="na">bootstrap</span><span class="pi">:</span>
    <span class="na">initdb</span><span class="pi">:</span>
      <span class="na">database</span><span class="pi">:</span> <span class="s">quizmentor</span>
      <span class="na">owner</span><span class="pi">:</span> <span class="s">quizmentor</span>
      
  <span class="na">storage</span><span class="pi">:</span>
    <span class="na">size</span><span class="pi">:</span> <span class="s">10Gi</span>
    <span class="na">storageClass</span><span class="pi">:</span> <span class="s">fast-ssd</span>
    
  <span class="na">monitoring</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    
  <span class="na">backup</span><span class="pi">:</span>
    <span class="na">retentionPolicy</span><span class="pi">:</span> <span class="s2">"</span><span class="s">30d"</span>
    <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">s3://backups/postgres"</span>
    
<span class="nn">---</span>
<span class="c1"># TimescaleDB for time-series data (events, analytics)</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">timescale-init</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">init.sql</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">CREATE EXTENSION IF NOT EXISTS timescaledb;</span>
    
    <span class="s">-- Events table for analytics</span>
    <span class="s">CREATE TABLE events (</span>
      <span class="s">id BIGSERIAL,</span>
      <span class="s">user_id UUID,</span>
      <span class="s">event_type TEXT,</span>
      <span class="s">properties JSONB,</span>
      <span class="s">timestamp TIMESTAMPTZ NOT NULL</span>
    <span class="s">);</span>
    
    <span class="s">-- Convert to hypertable</span>
    <span class="s">SELECT create_hypertable('events', 'timestamp');</span>
    
    <span class="s">-- Compression policy (compress data older than 7 days)</span>
    <span class="s">ALTER TABLE events SET (</span>
      <span class="s">timescaledb.compress,</span>
      <span class="s">timescaledb.compress_segmentby = 'user_id'</span>
    <span class="s">);</span>
    
    <span class="s">SELECT add_compression_policy('events', INTERVAL '7 days');</span>
</code></pre></div></div>

<hr />

<h2 id="3ï¸âƒ£-notification-system-multi-channel">3ï¸âƒ£ Notification System (Multi-channel)</h2>

<h3 id="novu---open-source-notification-infrastructure">Novu - Open Source Notification Infrastructure</h3>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># novu-deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">novu</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">novu-api</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/novuhq/novu/api:latest</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NODE_ENV</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">production</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DATABASE_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">postgresql://novu:pass@postgresql/novu</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">REDIS_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">redis://redis:6379</span>
        
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">novu-worker</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/novuhq/novu/worker:latest</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="c1"># Email providers</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">SENDGRID_API_KEY</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">secretKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">novu-secrets</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">sendgrid-key</span>
        <span class="c1"># SMS providers  </span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">TWILIO_ACCOUNT_SID</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">secretKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">novu-secrets</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">twilio-sid</span>
        <span class="c1"># Push notifications</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">FCM_KEY</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">secretKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">novu-secrets</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">fcm-key</span>
</code></pre></div></div>

<h3 id="notification-workflows">Notification Workflows</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/notifications/workflows.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Novu</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@novu/node</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">novu</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Novu</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NOVU_API_KEY</span><span class="p">);</span>

<span class="c1">// Multi-channel notification workflow</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">notifyLearningMilestone</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">milestone</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">novu</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="dl">'</span><span class="s1">learning-milestone</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">to</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">subscriberId</span><span class="p">:</span> <span class="nx">userId</span><span class="p">,</span>
      <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="na">phone</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">phone</span>
    <span class="p">},</span>
    <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">milestone</span><span class="p">:</span> <span class="nx">milestone</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
      <span class="na">points</span><span class="p">:</span> <span class="nx">milestone</span><span class="p">.</span><span class="nx">points</span><span class="p">,</span>
      <span class="na">nextGoal</span><span class="p">:</span> <span class="nx">milestone</span><span class="p">.</span><span class="nx">next</span>
    <span class="p">},</span>
    <span class="c1">// Channel fallback strategy</span>
    <span class="na">overrides</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">email</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">from</span><span class="p">:</span> <span class="dl">'</span><span class="s1">QuizMentor &lt;achievements@quizmentor.app&gt;</span><span class="dl">'</span>
      <span class="p">},</span>
      <span class="na">sms</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// Only send SMS for important milestones</span>
        <span class="na">condition</span><span class="p">:</span> <span class="nx">milestone</span><span class="p">.</span><span class="nx">points</span> <span class="o">&gt;</span> <span class="mi">100</span>
      <span class="p">},</span>
      <span class="na">push</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// Always send push if app installed</span>
        <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ğŸ‰ Achievement Unlocked!</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">body</span><span class="p">:</span> <span class="s2">`You've earned </span><span class="p">${</span><span class="nx">milestone</span><span class="p">.</span><span class="nx">points</span><span class="p">}</span><span class="s2"> points!`</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">deepLink</span><span class="p">:</span> <span class="s2">`/achievements/</span><span class="p">${</span><span class="nx">milestone</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="na">inApp</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// Always store in-app</span>
        <span class="na">persist</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Scheduled notifications (reminders)</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">scheduleStudyReminder</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">time</span><span class="p">:</span> <span class="nb">Date</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">novu</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="dl">'</span><span class="s1">study-reminder</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">to</span><span class="p">:</span> <span class="p">{</span> <span class="na">subscriberId</span><span class="p">:</span> <span class="nx">userId</span> <span class="p">},</span>
    <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">scheduledTime</span><span class="p">:</span> <span class="nx">time</span><span class="p">,</span>
      <span class="na">preferences</span><span class="p">:</span> <span class="k">await</span> <span class="nx">getUserPreferences</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="c1">// Respect user's quiet hours</span>
    <span class="na">respectQuietHours</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="c1">// Batch if multiple reminders</span>
    <span class="na">batch</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="4ï¸âƒ£-offline-first-architecture">4ï¸âƒ£ Offline-First Architecture</h2>

<h3 id="local-first-database-sync-rxdb--pouchdb">Local-First Database Sync (RxDB + PouchDB)</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/offline/database.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createRxDatabase</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxdb</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getRxStorageDexie</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxdb/plugins/storage-dexie</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Client-side database</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">setupOfflineDB</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">createRxDatabase</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">quizmentor</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">storage</span><span class="p">:</span> <span class="nx">getRxStorageDexie</span><span class="p">(),</span>
    <span class="na">multiInstance</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>

  <span class="c1">// Questions collection (synced)</span>
  <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">addCollections</span><span class="p">({</span>
    <span class="na">questions</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">schema</span><span class="p">:</span> <span class="nx">questionSchema</span><span class="p">,</span>
      <span class="na">sync</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">remote</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">API_URL</span><span class="p">}</span><span class="s2">/sync/questions`</span><span class="p">,</span>
        <span class="na">waitForLeadership</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">direction</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pull</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">live</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">retry</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    
    <span class="c1">// User progress (bidirectional sync)</span>
    <span class="na">progress</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">schema</span><span class="p">:</span> <span class="nx">progressSchema</span><span class="p">,</span>
      <span class="na">sync</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">remote</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">API_URL</span><span class="p">}</span><span class="s2">/sync/progress`</span><span class="p">,</span>
        <span class="na">direction</span><span class="p">:</span> <span class="dl">'</span><span class="s1">both</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">conflictHandler</span><span class="p">:</span> <span class="dl">'</span><span class="s1">last-write-wins</span><span class="dl">'</span>
      <span class="p">}</span>
    <span class="p">},</span>
    
    <span class="c1">// Offline sessions (sync when online)</span>
    <span class="na">sessions</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">schema</span><span class="p">:</span> <span class="nx">sessionSchema</span><span class="p">,</span>
      <span class="na">sync</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">remote</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">API_URL</span><span class="p">}</span><span class="s2">/sync/sessions`</span><span class="p">,</span>
        <span class="na">direction</span><span class="p">:</span> <span class="dl">'</span><span class="s1">push</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">batchSize</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="c1">// Queue changes when offline</span>
        <span class="na">offlineQueue</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Sync status monitoring</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">questions</span><span class="p">.</span><span class="nx">sync$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">active</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">showOfflineIndicator</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">db</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Service Worker for offline support</span>
<span class="c1">// sw.js</span>
<span class="nb">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">fetch</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/questions</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span>
      <span class="nx">caches</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="c1">// Return cached version when offline</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">response</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
          <span class="p">}</span>
          
          <span class="c1">// Fetch and update cache</span>
          <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">responseClone</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
            <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">quiz-data-v1</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">cache</span> <span class="o">=&gt;</span> <span class="p">{</span>
              <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">,</span> <span class="nx">responseClone</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
          <span class="p">});</span>
        <span class="p">})</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="conflict-resolution">Conflict Resolution</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/sync/conflict-resolver.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">ConflictResolver</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">local</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">remote</span><span class="p">:</span> <span class="kr">any</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// For quiz answers - local wins (user's device is truth)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">quiz_answer</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">local</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// For progress - merge strategy</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">progress</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">remote</span><span class="p">,</span>
        <span class="p">...</span><span class="nx">local</span><span class="p">,</span>
        <span class="na">score</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="nx">score</span><span class="p">,</span> <span class="nx">remote</span><span class="p">.</span><span class="nx">score</span><span class="p">),</span>
        <span class="na">updatedAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
      <span class="p">};</span>
    <span class="p">}</span>
    
    <span class="c1">// Default: last-write-wins</span>
    <span class="k">return</span> <span class="nx">local</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="o">&gt;</span> <span class="nx">remote</span><span class="p">.</span><span class="nx">updatedAt</span> <span class="p">?</span> <span class="nx">local</span> <span class="p">:</span> <span class="nx">remote</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="5ï¸âƒ£-mobile-app-architecture">5ï¸âƒ£ Mobile App Architecture</h2>

<h3 id="react-native--native-modules">React Native + Native Modules</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// mobile/src/services/native-features.ts</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">requestNotifications</span><span class="p">,</span>
  <span class="nx">scheduleNotification</span><span class="p">,</span>
  <span class="nx">getBatteryLevel</span><span class="p">,</span>
  <span class="nx">getNetworkState</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-native-permissions</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">BackgroundFetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-native-background-fetch</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">PushNotification</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-native-push-notification</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Background sync for mobile</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">setupBackgroundSync</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">BackgroundFetch</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span>
    <span class="na">minimumFetchInterval</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="c1">// 15 minutes</span>
    <span class="na">forceAlarmManager</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">stopOnTerminate</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">startOnBoot</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">enableHeadless</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span> <span class="k">async</span> <span class="p">(</span><span class="nx">taskId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Sync offline data</span>
    <span class="k">await</span> <span class="nx">syncOfflineData</span><span class="p">();</span>
    
    <span class="c1">// Pre-fetch next questions</span>
    <span class="k">await</span> <span class="nx">prefetchQuestions</span><span class="p">();</span>
    
    <span class="c1">// Update notifications</span>
    <span class="k">await</span> <span class="nx">updateStudyReminders</span><span class="p">();</span>
    
    <span class="nx">BackgroundFetch</span><span class="p">.</span><span class="nx">finish</span><span class="p">(</span><span class="nx">taskId</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Push notifications</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">setupPushNotifications</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">PushNotification</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span>
    <span class="na">onRegister</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">registerDevice</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
    <span class="p">},</span>
    
    <span class="na">onNotification</span><span class="p">:</span> <span class="p">(</span><span class="nx">notification</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Handle deep linking</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">notification</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">deepLink</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">navigation</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">notification</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">deepLink</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    
    <span class="c1">// iOS specific</span>
    <span class="na">permissions</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">alert</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">badge</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">sound</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    
    <span class="c1">// Android specific</span>
    <span class="na">channelId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">quizmentor</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">channelName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">QuizMentor Notifications</span><span class="dl">'</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Biometric authentication</span>
<span class="k">import</span> <span class="nx">TouchID</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-native-touch-id</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">authenticateWithBiometrics</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">biometryType</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">TouchID</span><span class="p">.</span><span class="nx">isSupported</span><span class="p">();</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">biometryType</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">TouchID</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="dl">'</span><span class="s1">Unlock QuizMentor</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Authentication Required</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">fallbackLabel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Use Passcode</span><span class="dl">'</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Fall back to password</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="mobile-specific-features">Mobile-Specific Features</h3>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Features matrix</span>
<span class="na">Mobile Features</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">Offline mode with sync</span>
  <span class="pi">-</span> <span class="s">Push notifications (FCM/APNS)</span>
  <span class="pi">-</span> <span class="s">Biometric auth (Face ID/Touch ID)</span>
  <span class="pi">-</span> <span class="s">Background sync</span>
  <span class="pi">-</span> <span class="s">App shortcuts</span>
  <span class="pi">-</span> <span class="s">Widgets (iOS 14+, Android 12+)</span>
  <span class="pi">-</span> <span class="s">Deep linking</span>
  <span class="pi">-</span> <span class="s">Share sheet integration</span>
  <span class="pi">-</span> <span class="s">Haptic feedback</span>
  <span class="pi">-</span> <span class="s">AR mode for visual questions</span>
  <span class="pi">-</span> <span class="s">Voice input for answers</span>
  <span class="pi">-</span> <span class="s">Handwriting recognition</span>
  <span class="pi">-</span> <span class="s">Screen time tracking</span>
  <span class="pi">-</span> <span class="s">Parental controls</span>
</code></pre></div></div>

<hr />

<h2 id="6ï¸âƒ£-event-tracking--analytics">6ï¸âƒ£ Event Tracking &amp; Analytics</h2>

<h3 id="posthog-self-hosted-product-analytics">PostHog (Self-Hosted Product Analytics)</h3>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># posthog-deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">posthog</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">posthog</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">posthog/posthog:latest</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DATABASE_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">postgresql://posthog:pass@postgresql/posthog</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">REDIS_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">redis://redis:6379</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CLICKHOUSE_HOST</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">clickhouse</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CLICKHOUSE_DATABASE</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">posthog</span>
</code></pre></div></div>

<h3 id="event-tracking-implementation">Event Tracking Implementation</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// lib/analytics/tracker.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PostHog</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">posthog-node</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ClickHouse</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">clickhouse</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">AnalyticsTracker</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">posthog</span><span class="p">:</span> <span class="nx">PostHog</span><span class="p">;</span>
  <span class="k">private</span> <span class="nx">clickhouse</span><span class="p">:</span> <span class="nx">ClickHouse</span><span class="p">;</span>
  
  <span class="k">async</span> <span class="nx">trackEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">AnalyticsEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Real-time to PostHog</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">posthog</span><span class="p">.</span><span class="nx">capture</span><span class="p">({</span>
      <span class="na">distinctId</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">userId</span><span class="p">,</span>
      <span class="na">event</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
      <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">event</span><span class="p">.</span><span class="nx">properties</span><span class="p">,</span>
        <span class="c1">// Automatic context</span>
        <span class="na">device</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">device</span><span class="p">,</span>
        <span class="na">location</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span>
        <span class="na">sessionId</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">sessionId</span><span class="p">,</span>
        <span class="na">timestamp</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="c1">// Batch to ClickHouse for analysis</span>
    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickhouse</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
      <span class="na">table</span><span class="p">:</span> <span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">values</span><span class="p">:</span> <span class="p">[{</span>
        <span class="na">user_id</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">userId</span><span class="p">,</span>
        <span class="na">event_type</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
        <span class="na">properties</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">properties</span><span class="p">),</span>
        <span class="na">timestamp</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
      <span class="p">}],</span>
      <span class="c1">// Batch insert for performance</span>
      <span class="na">clickhouse_settings</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">async_insert</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">wait_for_async_insert</span><span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="c1">// Pre-computed metrics</span>
  <span class="k">async</span> <span class="nx">getUserMetrics</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="s2">`
      SELECT
        COUNT(*) as total_events,
        COUNT(DISTINCT session_id) as sessions,
        AVG(quiz_score) as avg_score,
        quantile(0.5)(response_time) as median_response_time,
        dateDiff('day', MIN(timestamp), MAX(timestamp)) as days_active
      FROM events
      WHERE user_id = {userId:UUID}
        AND timestamp &gt; now() - INTERVAL 30 DAY
    `</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">clickhouse</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">{</span> <span class="nx">userId</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Feature flags with PostHog</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">checkFeatureFlag</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">flag</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">posthog</span><span class="p">.</span><span class="nx">isFeatureEnabled</span><span class="p">(</span><span class="nx">flag</span><span class="p">,</span> <span class="nx">userId</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// A/B Testing</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">getExperiment</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">experiment</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">variant</span> <span class="o">=</span> <span class="nx">posthog</span><span class="p">.</span><span class="nx">getFeatureFlag</span><span class="p">(</span><span class="nx">experiment</span><span class="p">,</span> <span class="nx">userId</span><span class="p">);</span>
  
  <span class="c1">// Track exposure</span>
  <span class="nx">posthog</span><span class="p">.</span><span class="nx">capture</span><span class="p">({</span>
    <span class="na">distinctId</span><span class="p">:</span> <span class="nx">userId</span><span class="p">,</span>
    <span class="na">event</span><span class="p">:</span> <span class="dl">'</span><span class="s1">$feature_flag_called</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">$feature_flag</span><span class="p">:</span> <span class="nx">experiment</span><span class="p">,</span>
      <span class="na">$feature_flag_response</span><span class="p">:</span> <span class="nx">variant</span>
    <span class="p">}</span>
  <span class="p">});</span>
  
  <span class="k">return</span> <span class="nx">variant</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="7ï¸âƒ£-complete-kubernetes-manifests">7ï¸âƒ£ Complete Kubernetes Manifests</h2>

<h3 id="cluster-setup">Cluster Setup</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create cluster on Digital Ocean</span>
doctl kubernetes cluster create quizmentor <span class="se">\</span>
  <span class="nt">--node-pool</span> <span class="s2">"name=system;size=s-2vcpu-4gb;count=2"</span> <span class="se">\</span>
  <span class="nt">--node-pool</span> <span class="s2">"name=compute;size=s-4vcpu-8gb;count=3"</span> <span class="se">\</span>
  <span class="nt">--region</span> nyc1

<span class="c"># Total: 5 nodes = ~$150/month</span>
</code></pre></div></div>

<h3 id="resource-allocation">Resource Allocation</h3>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># resource-quotas.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ResourceQuota</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">compute-quota</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">hard</span><span class="pi">:</span>
    <span class="na">requests.cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20"</span>      <span class="c1"># 20 cores total</span>
    <span class="na">requests.memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">40Gi"</span>  <span class="c1"># 40GB total</span>
    <span class="na">persistentvolumeclaims</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10"</span>
    
<span class="nn">---</span>
<span class="c1"># Pod distribution</span>
<span class="na">Services</span><span class="pi">:</span>
  <span class="na">Frontend</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">Next.js</span><span class="pi">:</span> <span class="s">2 replicas Ã— 512MB = 1GB</span>
    <span class="pi">-</span> <span class="na">Admin</span><span class="pi">:</span> <span class="s">1 replica Ã— 256MB = 256MB</span>
    
  <span class="na">AI Engines</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">Bloom</span><span class="pi">:</span> <span class="s">2 replicas Ã— 2GB = 4GB</span>
    <span class="pi">-</span> <span class="na">Adaptive</span><span class="pi">:</span> <span class="s">2 replicas Ã— 2GB = 4GB</span>
    <span class="pi">-</span> <span class="na">Orchestrator</span><span class="pi">:</span> <span class="s">2 replicas Ã— 1GB = 2GB</span>
    
  <span class="na">Platform</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">Keycloak</span><span class="pi">:</span> <span class="s">2 replicas Ã— 512MB = 1GB</span>
    <span class="pi">-</span> <span class="na">Novu</span><span class="pi">:</span> <span class="s">2 replicas Ã— 512MB = 1GB</span>
    <span class="pi">-</span> <span class="na">PostHog</span><span class="pi">:</span> <span class="s">2 replicas Ã— 1GB = 2GB</span>
    
  <span class="na">Databases</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">PostgreSQL</span><span class="pi">:</span> <span class="s">3 replicas Ã— 2GB = 6GB</span>
    <span class="pi">-</span> <span class="na">Redis</span><span class="pi">:</span> <span class="s">1 replica Ã— 512MB = 512MB</span>
    <span class="pi">-</span> <span class="na">Qdrant</span><span class="pi">:</span> <span class="s">1 replica Ã— 2GB = 2GB</span>
    <span class="pi">-</span> <span class="na">ClickHouse</span><span class="pi">:</span> <span class="s">1 replica Ã— 2GB = 2GB</span>
    
  <span class="na">Background</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">Scrapers</span><span class="pi">:</span> <span class="s">1GB (burst)</span>
    <span class="pi">-</span> <span class="na">Workers</span><span class="pi">:</span> <span class="s">2GB (burst)</span>
    
<span class="na">Total</span><span class="pi">:</span> <span class="s">~28GB RAM, ~15 CPUs used</span>
<span class="na">Available</span><span class="pi">:</span> <span class="s">40GB RAM, 20 CPUs</span>
<span class="na">Buffer</span><span class="pi">:</span> <span class="s">30% headroom</span>
</code></pre></div></div>

<hr />

<h2 id="-cost-breakdown">ğŸ’° Cost Breakdown</h2>

<h3 id="self-hosted-everything">Self-Hosted Everything</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Digital Ocean K8s (5 nodes):    $150/month
CloudFlare Pro:                 $20/month
Domain:                          $1/month
Email (SendGrid):                $10/month
SMS (Twilio):                    $10/month
Backups (B2):                    $5/month
Monitoring (Free tier):          $0
--------------------------------
Total:                           $196/month

What You Get:
- Unlimited users
- Full data ownership  
- No vendor lock-in
- Complete feature control
- GDPR compliance easy
- Can sell to enterprises
</code></pre></div></div>

<h3 id="comparison-with-managed-services">Comparison with Managed Services</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Supabase:                        $25/month
Auth0:                           $23/month
Vercel Pro:                      $20/month
Qdrant Cloud:                    $69/month
SendGrid:                        $15/month
Analytics (Mixpanel):            $25/month
Novu Cloud:                      $50/month
--------------------------------
Total:                           $227/month

Plus:
- Limited by quotas
- Data in multiple places
- Vendor lock-in
- Less control
</code></pre></div></div>

<hr />

<h2 id="-implementation-roadmap">ğŸš€ Implementation Roadmap</h2>

<h3 id="phase-1-week-1-core-infrastructure">Phase 1 (Week 1): Core Infrastructure</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. Setup cluster</span>
./scripts/setup-cluster.sh

<span class="c"># 2. Install operators</span>
kubectl apply <span class="nt">-f</span> k8s/operators/

<span class="c"># 3. Deploy databases</span>
kubectl apply <span class="nt">-f</span> k8s/databases/

<span class="c"># 4. Deploy auth (Keycloak)</span>
kubectl apply <span class="nt">-f</span> k8s/auth/
</code></pre></div></div>

<h3 id="phase-2-week-2-services">Phase 2 (Week 2): Services</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. Deploy AI engines</span>
kubectl apply <span class="nt">-f</span> k8s/engines/

<span class="c"># 2. Deploy API gateway</span>
kubectl apply <span class="nt">-f</span> k8s/gateway/

<span class="c"># 3. Deploy frontend</span>
kubectl apply <span class="nt">-f</span> k8s/frontend/
</code></pre></div></div>

<h3 id="phase-3-week-3-platform-features">Phase 3 (Week 3): Platform Features</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. Setup notifications</span>
kubectl apply <span class="nt">-f</span> k8s/notifications/

<span class="c"># 2. Setup analytics</span>
kubectl apply <span class="nt">-f</span> k8s/analytics/

<span class="c"># 3. Setup monitoring</span>
kubectl apply <span class="nt">-f</span> k8s/monitoring/
</code></pre></div></div>

<h3 id="phase-4-week-4-mobile--offline">Phase 4 (Week 4): Mobile &amp; Offline</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. Deploy sync service</span>
kubectl apply <span class="nt">-f</span> k8s/sync/

<span class="c"># 2. Setup push notifications</span>
kubectl apply <span class="nt">-f</span> k8s/push/

<span class="c"># 3. Deploy mobile API</span>
kubectl apply <span class="nt">-f</span> k8s/mobile/
</code></pre></div></div>

<hr />

<h2 id="-benefits-of-this-architecture">âœ… Benefits of This Architecture</h2>

<ol>
  <li><strong>Complete Control</strong>: Every piece self-hosted</li>
  <li><strong>Cost Effective</strong>: $196/mo for unlimited scale</li>
  <li><strong>Feature Rich</strong>: Notifications, offline, mobile, analytics</li>
  <li><strong>Performance</strong>: Sub-100ms response times</li>
  <li><strong>Scalability</strong>: Can handle 1M+ users</li>
  <li><strong>Compliance</strong>: GDPR, HIPAA ready</li>
  <li><strong>Monetization</strong>: Can white-label or enterprise sell</li>
</ol>

<hr />

<h2 id="-final-decision">ğŸ¯ Final Decision</h2>

<p><strong>Go with full self-hosted Kubernetes because:</strong></p>
<ul>
  <li>You need complex AI processing (requires K8s)</li>
  <li>You want offline &amp; mobile (requires control)</li>
  <li>You need notifications (cheaper self-hosted)</li>
  <li>Total cost is actually LOWER ($196 vs $227)</li>
  <li>You get 10x more features and control</li>
</ul>

<p><strong>This is the right architecture for a serious learning platform!</strong></p>



<div style="margin-top: 3rem; padding: 1rem; background: #f6f8fa; border-radius: 5px;">
  <p style="margin: 0; color: #666; font-size: 0.9em;">
    ğŸ“ Source: QuizMentor / COMPLETE_SELF_HOSTED_ARCHITECTURE.md
  </p>
</div>

  </main>

  <footer>
    <p>&copy; 2024 NatureQuest. Documentation Hub v1.0.0</p>
  </footer>

  <script>
    (function() {
      const html = document.documentElement;
      const buttons = [];
      function setActive(theme) {
        buttons.forEach(b => {
          const active = b.dataset.theme === theme;
          b.classList.toggle('active', active);
          b.setAttribute('aria-pressed', active ? 'true' : 'false');
        });
      }
      function applyTheme(theme) {
        if (theme === 'auto') {
          html.removeAttribute('data-theme');
          localStorage.removeItem('theme');
        } else {
          html.setAttribute('data-theme', theme);
          localStorage.setItem('theme', theme);
        }
        setActive(theme);
      }
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.theme-btn').forEach(btn => {
          buttons.push(btn);
          btn.addEventListener('click', () => applyTheme(btn.dataset.theme));
        });
        const saved = localStorage.getItem('theme');
        if (saved === 'light' || saved === 'dark') {
          applyTheme(saved);
        } else {
          applyTheme('auto');
        }
      });
    })();
  </script>
</body>
</html>
